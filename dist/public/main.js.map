{"version":3,"sources":["../../public/main.js"],"names":["form","$","tagFilter","sortField","log","loadMore","lastDate","TAGS","location","search","indexOf","addClass","tagOptions","Object","keys","map","key","join","find","html","submit","id","val","title","text","tags","filter","i","data","req","ajax","url","method","dataType","post","done","removeAttr","end","loadLog","on","editLogItem","deleteLogItem","loadNextLog","loadPage","items","append","v","length","get","then","resp","logItem","_id","moment","format","formatText","replace","e","parents","ctrlKey","altKey","shiftKey","initDelete","initEdit","response","confirm"],"mappings":"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","file":"main.js","sourcesContent":["let form = $();\nlet tagFilter = $();\nlet sortField = $();\nlet log = $();\nlet loadMore = $();\nlet lastDate = null;\n\nlet TAGS = {\n\t\"fragment\": \"Фрагмент\",\n\t\"clarity\": \"Ясность\",\n\t\"whisper\": \"Голос\",\n\t\"decomposition\": \"Разбор\",\n\t\"practice\": \"Практика\",\n\t\"past\": \"Прошлое\",\n\t\"ozv\": \"ОзВ\",\n\t\"ne\": \"НЭ\",\n\t\"morda\": \"Морда\",\n\t\"ozf\": \"ОзФ\",\n\t\"feeling\": \"Ощущение\",\n};\n\n$(function() {\n\tif (location.search.indexOf(\"edit\") !== -1) {\n\t\t$(\"body\").addClass(\"editable\")\n\t}\n\tform = $(\"#editor\");\n\ttagFilter = $(\"#tag-filter\");\n\tsortField = $(\"#sort-field\");\n\tlog = $(\"#log-list\");\n\tloadMore = $(\"#load-more\");\n\n\tlet tagOptions = \"<option></option>\" + Object.keys(TAGS).map((key) => {\n\t\treturn \"<option value='\" + key + \"'>\" + TAGS[key] + \"</option>\"\n\t}).join(\"\");\n\n\tform.find(\"[name='tags']\").html(tagOptions);\n\ttagFilter.html(tagOptions);\n\n\tform.submit(function() {\n\t\tlet id = $(this).find(\"[name='id']\").val();\n\t\tlet title = $(this).find(\"[name='title']\").val();\n\t\tlet text = $(this).find(\"[name='text']\").val();\n\t\tlet tags = $(this).find(\"[name='tags']\").val().filter(function(i) {\n\t\t\treturn !!i\n\t\t});\n\n\t\tlet data = {\n\t\t\ttitle: title,\n\t\t\ttext: text,\n\t\t\ttags: tags,\n\t\t};\n\n\t\tlet req;\n\t\tif (id !== \"\") {\n\t\t\treq = $.ajax({\n\t\t\t\turl: \"/api/log-item/\" + id,\n\t\t\t\tdata: data,\n\t\t\t\tmethod: \"PUT\",\n\t\t\t\tdataType: \"json\",\n\t\t\t});\n\t\t} else {\n\t\t\treq = $.post(\"/api/log-item\", data)\n\t\t}\n\t\treq.done(function() {\n\t\t\tform.find(':radio, :checkbox').removeAttr('checked').end()\n\t\t\t\t.find('textarea, :text, :hidden, select').val('');\n\t\t\tloadLog()\n\t\t});\n\t\treturn false;\n\t});\n\tloadLog();\n\n\t$(\"body\")\n\t\t.on(\"click\", \".log-item .edit\", editLogItem)\n\t\t.on(\"click\", \".log-item .delete\", deleteLogItem);\n\n\ttagFilter.on(\"change\", loadLog);\n\tsortField.on(\"change\", loadLog);\n\tloadMore.on('click', loadNextLog);\n});\n\nfunction loadLog() {\n\tlastDate = null;\n\tloadPage().done((items) => {\n\t\tlog.html(items.join(\"<hr/>\"));\n\t});\n}\n\nfunction loadNextLog() {\n\tloadPage().done((items) => {\n\t\tlog.append(\"<hr/>\" + items.join(\"<hr/>\"));\n\t});\n}\n\nfunction loadPage() {\n\tlet tags = tagFilter.val().filter((v) => !!v);\n\tlet data = {\n\t\t\"sortField\": sortField.val()\n\t};\n\n\tif (tags.length) {\n\t\tdata.tags = tagFilter.val();\n\t}\n\tif (lastDate) {\n\t\tdata.lastDate = lastDate;\n\t}\n\treturn $.get(\"/api/log-item\", data).then(function(resp) {\n\t\tlastDate = resp.length !== 0 ? resp[resp.length - 1][sortField.val()] : null;\n\t\treturn resp.map(function(logItem) {\n\t\t\treturn \"<div class='log-item' data-id='\" + logItem._id + \"'>\" +\n\t\t\t\t\"<div class='buttons'>\" +\n\t\t\t\t\"<div class='button edit'></div>\" +\n\t\t\t\t// \"<div class='button delete'></div>\" +\n\t\t\t\t\"</div>\" +\n\t\t\t\t\"<div class='title'>\" +\n\t\t\t\t\"<span class='date'>\" + moment(logItem[\"created\"]).format(\"DD MMM YY, HH:MM\") + \"</span>\" + \" \" + logItem[\"title\"] + \" \" + (logItem[\"tags\"]).map((i) => \"<span class='tag'>\" + TAGS[i] + \"</span>\").join(\"\") +\n\t\t\t\t\"</div>\" +\n\t\t\t\t\"<div>\" + formatText(logItem[\"text\"])+ \"</div>\" +\n\t\t\t\t\"</div>\"\n\t\t});\n\t});\n}\n\nfunction formatText(text) {\n\ttext = text.replace(/\\n/g, \"<br/>\");\n\n\treturn text;\n}\n\nfunction editLogItem(e) {\n\tlet id = $(this).parents(\".log-item\").data(\"id\");\n\tif (e.ctrlKey && e.altKey && e.shiftKey) {\n\t\tinitDelete(id);\n\t} else {\n\t\tinitEdit(id);\n\t}\n}\n\nfunction initEdit(id) {\n\t$.get(\"/api/log-item/\" + id).done(function(response) {\n\t\tlet logItem = response.logItem;\n\t\tform.find(\"[name='id']\").val(id);\n\t\tform.find(\"[name='title']\").val(logItem.title);\n\t\tform.find(\"[name='text']\").val(logItem.text);\n\t\tform.find(\"[name='tags']\").val(logItem.tags);\n\n\t})\n}\n\nfunction deleteLogItem() {\n\tlet id = $(this).parents(\".log-item\").data(\"id\");\n\tinitDelete(id);\n}\n\nfunction initDelete(id) {\n\tif (confirm(\"Удалить запись? Это будет не вернуть!\")) {\n\t\t$.ajax({\n\t\t\turl: \"/api/log-item/\" + id,\n\t\t\tmethod: \"DELETE\",\n\t\t}).done(function() {\n\t\t\tloadLog();\n\t\t})\n\t}\n}\n"]}